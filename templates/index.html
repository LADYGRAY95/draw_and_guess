<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Draw & Guess AI</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='cpulogo.png') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; background: #131D4F; margin: 0; padding: 0; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; color: white; }

    .container { display: flex; gap: 20px; margin-top: 40px; }

    /* Sidebar */
    .sidebar {
      background: #1E2A6F;
      padding: 20px;
      border-radius: 20px;
      min-width: 140px;
    }
    .sidebar h2 { font-size: 1.2rem; margin-bottom: 15px; text-align: center; }
    .object-item { display: flex; align-items: center; padding: 6px 10px; margin: 5px 0; border-radius: 10px; cursor: default; transition: 0.2s; }
    .object-item i { margin-right: 8px; }
    .object-item.highlight { background: #3498db; color: #fff; font-weight: bold; }

    /* Canvas panel */
    .canvas-panel {
      background: #fff;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      flex-grow: 1;
      max-width: 500px;
    }

    #canvas { border: 3px solid #333; border-radius: 12px; background: #fff; width: 100%; height: 280px; touch-action: none; cursor: crosshair; margin-bottom: 15px; }

    .button-group { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
    .btn { padding: 10px 18px; font-size: 16px; border: none; border-radius: 10px; cursor: pointer; transition: 0.2s; }
    .btn-clear { background: #e74c3c; color: #fff; } .btn-clear:hover { background: #c0392b; }
    .btn-guess { background: #3498db; color: #fff; } .btn-guess:hover { background: #2980b9; }

    #result { margin-top: 15px; font-size: 18px; font-weight: bold; color: #2c3e50; text-align: center; }

    /* Logo */
    .logo {
      height: 150px;          
      position: absolute;    /* Lock it in the corner */
      top: 1px;
      left: 10px;
      filter: brightness(0) invert(1);  /* Makes black â†’ white */
    }


    @media (max-width: 800px) {
      .container { flex-direction: column; align-items: center; }
      .sidebar { min-width: 100%; max-width: 400px; }
      .canvas-panel { max-width: 400px; }
    }
  </style>
</head>
<body>
  <div class="logo">
    <img src="{{ url_for('static', filename='cpulogo.png') }}" alt="Logo" class="logo">
  </div>
  <div class="container">
    <div class="sidebar">
      <h2>Objects</h2>
      <div id="object-list"></div>
    </div>
    <div class="canvas-panel">
      <canvas id="canvas"></canvas>
      <div class="button-group">
        <button class="btn btn-clear"><i class="fa-solid fa-trash"></i> Clear</button>
        <button class="btn btn-guess"><i class="fa-solid fa-magic"></i> Guess</button>
      </div>
      <p id="result">Draw something!</p>
    </div>
  </div>

  <script>
    const categories = [
      { name: "apple", icon: "fa-apple-whole" },
      { name: "airplane", icon: "fa-plane" },
      { name: "banana", icon: "fa-lemon" },
      { name: "cat", icon: "fa-cat" },
      { name: "dog", icon: "fa-dog" },
      { name: "car", icon: "fa-car" },
      { name: "chair", icon: "fa-chair" },
      { name: "clock", icon: "fa-clock" },
      { name: "house", icon: "fa-house" },
      { name: "tree", icon: "fa-tree" }
    ];

    const objectList = document.getElementById("object-list");
    categories.forEach(cat => {
      const div = document.createElement("div");
      div.className = "object-item";
      div.id = `obj-${cat.name}`;
      div.innerHTML = `<i class="fa-solid ${cat.icon}"></i> ${cat.name}`;
      objectList.appendChild(div);
    });

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    const setBrush = () => {
      ctx.strokeStyle = "black";
      ctx.lineWidth = 4;
      ctx.lineCap = "round";
    };

    const resizeCanvas = () => {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      ctx.fillStyle = "white";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      setBrush();
    };
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    let drawing = false;
    const getPos = e => {
      const rect = canvas.getBoundingClientRect();
      return { x: (e.clientX - rect.left) * (canvas.width / rect.width),
               y: (e.clientY - rect.top) * (canvas.height / rect.height) };
    };
    const getTouchPos = t => {
      const rect = canvas.getBoundingClientRect();
      return { x: (t.clientX - rect.left) * (canvas.width / rect.width),
               y: (t.clientY - rect.top) * (canvas.height / rect.height) };
    };

    canvas.addEventListener("mousedown", e => { drawing = true; ctx.beginPath(); });
    canvas.addEventListener("mouseup", () => { drawing = false; });
    canvas.addEventListener("mouseout", () => { drawing = false; });
    canvas.addEventListener("mousemove", e => { if(drawing){ const p=getPos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); } });

    canvas.addEventListener("touchstart", e => { e.preventDefault(); drawing = true; ctx.beginPath(); });
    canvas.addEventListener("touchend", e => { drawing = false; });
    canvas.addEventListener("touchmove", e => { e.preventDefault(); if(drawing){ const p=getTouchPos(e.touches[0]); ctx.lineTo(p.x,p.y); ctx.stroke(); } });

    document.querySelector(".btn-clear").addEventListener("click", () => {
      ctx.fillStyle = "white"; ctx.fillRect(0,0,canvas.width,canvas.height);
      document.getElementById("result").innerText = "Draw something!";
      document.querySelectorAll(".object-item").forEach(el => el.classList.remove("highlight"));
    });

    document.querySelector(".btn-guess").addEventListener("click", async () => {
      const dataURL = canvas.toDataURL("image/png");
      const response = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: dataURL })
      });
      const data = await response.json();

      document.getElementById("result").innerText =
        `Prediction: ${data.prediction} (${(data.confidence*100).toFixed(1)}%)`;

      document.querySelectorAll(".object-item").forEach(el => el.classList.remove("highlight"));
      const predEl = document.getElementById(`obj-${data.prediction}`);
      if(predEl) predEl.classList.add("highlight");
    });
  </script>
</body>
</html>
